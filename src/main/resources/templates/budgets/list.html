<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Budgets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/dashboard">SmartSpend</a>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-light btn-sm" href="/expenses">Expenses</a>
            <a class="btn btn-outline-light btn-sm" href="/budgets">Budgets</a>
            <a class="btn btn-outline-light btn-sm" href="/notifications">Notifications</a>
            <a class="btn btn-warning btn-sm" href="/logout">Logout</a>
        </div>
    </div>
</nav>

<div class="container my-4" style="max-width:980px;">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Budgets</h3>
        <div class="d-flex gap-2">
            <a class="btn btn-secondary" href="/dashboard">Back to Dashboard</a>
            <a class="btn btn-outline-secondary" href="/expenses">Go to Expenses</a>
        </div>
    </div>

    <!-- Month filter -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <form method="get" action="/budgets" class="row g-2 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">Select Month</label>
                    <input class="form-control" type="month" name="month" th:value="${month}">
                </div>
                <div class="col-md-2 d-grid">
                    <button class="btn btn-dark">View</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Set / Update -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <form th:action="@{/budgets}" th:object="${budgetDto}" method="post" class="row g-2 mt-2">
                <!-- hidden id for edit -->
                <input type="hidden" name="id" th:value="${editId}">

                <div class="col-md-3">
                    <label class="form-label">Month</label>
                    <input class="form-control" th:field="*{month}" placeholder="2026-01">
                    <div class="text-danger" th:errors="*{month}"></div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Category</label>

                    <select class="form-select" th:field="*{category}">
                        <option value="" disabled selected>Select category</option>

                        <option value="Food">Food</option>
                        <option value="Travel">Travel</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Rent">Rent</option>
                        <option value="Bills">Bills</option>
                        <option value="Health">Health</option>
                        <option value="Other">Other</option>
                    </select>

                    <div class="text-danger" th:errors="*{category}"></div>
                </div>


                <div class="col-md-3">
                    <label class="form-label">Limit Amount</label>
                    <input class="form-control" th:field="*{limitAmount}" placeholder="1500">
                    <div class="text-danger" th:errors="*{limitAmount}"></div>
                </div>

                <div class="col-md-2 d-grid">
                    <button class="btn btn-primary" th:text="${editId} != null ? 'Update' : 'Save'">Save</button>
                </div>
            </form>

            <div th:if="${editId != null}" class="alert alert-info mt-3 mb-0">
                Editing budget ID: <span th:text="${editId}"></span>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="mb-3">Your Budgets (<span th:text="${month}"></span>)</h5>

            <div class="table-responsive">
                <table class="table table-striped align-middle">
                    <thead>
                    <tr>
                        <th>Month</th>
                        <th>Category</th>
                        <th>Limit</th>
                        <th style="width:220px;">Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="b : ${budgets}">
                        <td th:text="${b.month}"></td>
                        <td th:text="${b.category}"></td>
                        <td th:text="${b.limitAmount}"></td>
                        <td class="d-flex gap-2">
                            <a class="btn btn-sm btn-outline-primary"
                               th:href="@{/budgets(month=${month}, editId=${b.id})}">
                                Edit
                            </a>

                            <form th:action="@{'/budgets/' + ${b.id} + '/delete'}" method="post">
                                <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete?')">Delete</button>
                            </form>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(budgets)}">
                        <td colspan="4" class="text-muted">No budgets for this month.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</div>
</body>
</html>
