<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head('Expenses')"></head>
<body class="bg-light">

<div th:replace="layout :: nav"></div>

<div class="container my-4">
    <div id="wsAlert" class="alert alert-info d-none"></div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Expenses</h3>

        <div class="d-flex gap-2">
            <a class="btn btn-secondary" href="/dashboard">Back to Dashboard</a>
            <a class="btn btn-outline-secondary" href="/budgets">Back to Budgets</a>
            <a class="btn btn-primary" href="/expenses/new">+ Add</a>
        </div>
    </div>


    <form class="row g-2 mb-3" method="get" action="/expenses">
        <div class="col-md-2">
            <select class="form-select" name="type">
                <option value="">All Type</option>
                <option value="EXPENSE" th:selected="${type=='EXPENSE'}">EXPENSE</option>
                <option value="INCOME" th:selected="${type=='INCOME'}">INCOME</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" name="category">
                <option value="" th:selected="${category == null || category == ''}">All Categories</option>
                <option value="Food" th:selected="${category == 'Food'}">Food</option>
                <option value="Travel" th:selected="${category == 'Travel'}">Travel</option>
                <option value="Shopping" th:selected="${category == 'Shopping'}">Shopping</option>
                <option value="Rent" th:selected="${category == 'Rent'}">Rent</option>
                <option value="Bills" th:selected="${category == 'Bills'}">Bills</option>
                <option value="Health" th:selected="${category == 'Health'}">Health</option>
                <option value="Other" th:selected="${category == 'Other'}">Other</option>
            </select>
        </div>

        <div class="col-md-2"><input class="form-control" type="date" name="fromDate" th:value="${fromDate}"></div>
        <div class="col-md-2"><input class="form-control" type="date" name="toDate" th:value="${toDate}"></div>
        <div class="col-md-2"><input class="form-control" name="minAmount" th:value="${minAmount}" placeholder="Min"></div>
        <div class="col-md-2"><input class="form-control" name="maxAmount" th:value="${maxAmount}" placeholder="Max"></div>

        <div class="col-md-3">
            <select class="form-select" name="sort">
                <option value="dateDesc" th:selected="${sort=='dateDesc'}">Date ↓</option>
                <option value="dateAsc" th:selected="${sort=='dateAsc'}">Date ↑</option>
                <option value="amountDesc" th:selected="${sort=='amountDesc'}">Amount ↓</option>
                <option value="amountAsc" th:selected="${sort=='amountAsc'}">Amount ↑</option>
            </select>
        </div>

        <div class="col-md-3 d-grid">
            <button class="btn btn-dark">Filter</button>
        </div>

        <div class="col-md-6 d-flex gap-2">
            <a class="btn btn-outline-danger"
               th:href="@{/expenses/export/pdf(type=${type},category=${category},fromDate=${fromDate},toDate=${toDate},minAmount=${minAmount},maxAmount=${maxAmount},sort=${sort})}">
                Export PDF
            </a>
            <a class="btn btn-outline-success"
               th:href="@{/expenses/export/excel(type=${type},category=${category},fromDate=${fromDate},toDate=${toDate},minAmount=${minAmount},maxAmount=${maxAmount},sort=${sort})}">
                Export Excel
            </a>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead>
            <tr>
                <th>Date</th><th>Type</th><th>Category</th><th>Title</th><th>Amount</th><th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="e : ${expenses}">
                <td th:text="${e.date}"></td>
                <td>
                    <span class="badge bg-danger" th:if="${e.type=='EXPENSE'}">EXPENSE</span>
                    <span class="badge bg-success" th:if="${e.type=='INCOME'}">INCOME</span>
                </td>
                <td th:text="${e.category}"></td>
                <td th:text="${e.title}"></td>
                <td th:text="${e.amount}"></td>
                <td class="d-flex gap-2">
                    <a class="btn btn-sm btn-outline-primary" th:href="@{'/expenses/' + ${e.id} + '/edit'}">Edit</a>
                    <form th:action="@{'/expenses/' + ${e.id} + '/delete'}" method="post">
                        <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete?')">Delete</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div th:replace="layout :: scripts(${session.USER_ID})"></div>
</body>
</html>
